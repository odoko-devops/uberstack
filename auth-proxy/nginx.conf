# RANCHER CONFIGURATION
server {
  listen 80 default_server;
  listen [::]:80 default_server ipv6only=on;

  server_name $RANCHER_HOST;
  location / {
    auth_basic              "Restricted";
    auth_basic_user_file    /etc/htpasswd;
    proxy_set_header Host \$host;
    proxy_set_header X-Forwarded-Host \$host:\$server_port;
    proxy_set_header X-Forwarded-Server \$host;
    proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
    proxy_pass http://172.17.0.1:$RANCHER_PORT;
  }
}

# JENKINS CONFIGURATION
server {
  listen 80;
  listen [::]:80;

  server_name $JENKINS_HOST;
  location / {
    auth_basic              "Restricted";
    auth_basic_user_file    /etc/htpasswd;
    proxy_set_header Host \$host;
    proxy_set_header X-Forwarded-Host \$host:\$server_port;
    proxy_set_header X-Forwarded-Server \$host;
    proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
    proxy_pass http://172.17.0.1:$JENKINS_PORT;
  }
}

